version: "3"
services:
  hub:
    image: selenium/hub:3.141.59
    container_name: hub
    ports:
      - 4444:4444

  pubsub:
    image: nginx
    volumes:
      - ./client:/usr/share/nginx/html
    ports:
      - 8000:80

  sfu:
    image: pionwebrtc/ion-sfu:latest-jsonrpc
    ports:
      - "5000-5200:5000-5200/udp"
      - 7000:7000

  chrome:
    image: selenium/node-chrome:3.141.59
    depends_on:
      - hub
    environment:
      - HUB_HOST=hub

  kite:
    build:
      context: .
    volumes:
      - /dev/shm:/dev/shm
      - ./:/workspace/test
    depends_on:
      - hub
      - sfu
      - pubsub
    environment:
      - HUB_HOST=hub
      - HUB_PORT=4444
      - KITE_TEST_PATH=/workspace/test
      - KITE_CONFIG_NAME=js.pubsub.config.json
